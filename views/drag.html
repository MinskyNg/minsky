<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>拖拽碰撞</title><link rel="stylesheet" type="text/css" href="/css/libs/normalize.min.css"><style type="text/css">#drag-list{position:absolute;top: 50%;left: 50%;width:660px;height:660px;margin-top: -330px;margin-left: -330px;padding:0}#drag-list li{float:left;z-index:1;width:200px;height:200px;margin:10px;list-style:none}#drag-list .active{border:1px dashed #000}</style></head><body><ul id="drag-list"><li><img src="/img/drag6.jpg" alt="6"></li><li><img src="/img/drag4.jpg" alt="4"></li><li><img src="/img/drag3.jpg" alt="3"></li><li><img src="/img/drag9.jpg" alt="9"></li><li><img src="/img/drag8.jpg" alt="8"></li><li><img src="/img/drag1.jpg" alt="1"></li><li><img src="/img/drag7.jpg" alt="7"></li><li><img src="/img/drag5.jpg" alt="5"></li><li><img src="/img/drag2.jpg" alt="2"></li></ul><script src="/js/libs/jquery.min.js"></script><script type="text/javascript">!function(t){function e(e,i){this.$tar=e,this.dragItem=t.makeArray(e),this.dragLen=this.dragItem.length,this.activeClass=i.activeClass,this.dragWidth=i.dragWidth,this.dragZindex=i.dragZindex,this.aniTime=i.aniTime,this.dragPos=[],this.init()}e.prototype={init:function(){var t=0;for(t=0;t<this.dragLen;t++)this.dragPos[t]={left:this.dragItem[t].offsetLeft,top:this.dragItem[t].offsetTop};for(t=0;t<this.dragLen;t++)this.dragItem[t].style.position="absolute",this.dragItem[t].style.left=this.dragPos[t].left+"px",this.dragItem[t].style.top=this.dragPos[t].top+"px",this.dragItem[t].style.margin=0,this.dragItem[t].index=t;for(t=0;t<this.dragLen;t++)this._bindEvent(this.dragItem[t])},_bindEvent:function(e){var s=this;e.onmousedown=function(n){var a=n||event;e.style.zIndex=s.dragZindex++;var r=a.clientX-e.offsetLeft,o=a.clientY-e.offsetTop;document.onmousemove=function(t){var n=t||event;for(e.style.left=n.clientX-r+"px",e.style.top=n.clientY-o+"px",i=0;i<s.dragLen;i++)s.dragItem[i].className="";var a=s.findNearest(e);a&&(a.className=s.activeClass)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null;var i=s.findNearest(e);if(i){i.className="",i.style.zIndex=s.dragZindex++,e.style.zIndex=s.dragZindex++,s.startMove(i,s.dragPos[e.index]),s.startMove(e,s.dragPos[i.index]);var n=0;n=e.index,e.index=i.index,i.index=n,t(document).trigger("exchanged",[e,i])}else s.startMove(e,s.dragPos[e.index])},a.preventDefault()}},findNearest:function(t){var e=9999999,s=-1;for(i=0;i<this.dragLen;i++)if(t!==this.dragItem[i]&&this.collideTest(t,this.dragItem[i])){var n=this.getDis(t,this.dragItem[i]);e>n&&(e=n,s=i)}return-1===s?null:this.dragItem[s]},collideTest:function(t,e){var i=t.offsetLeft,s=t.offsetLeft+this.dragWidth,n=t.offsetTop,a=t.offsetTop+this.dragWidth,r=e.offsetLeft,o=e.offsetLeft+this.dragWidth,d=e.offsetTop,f=e.offsetTop+this.dragWidth;return r>s||i>o||d>a||n>f?!1:!0},getDis:function(t,e){var i=t.offsetLeft-e.offsetLeft,s=t.offsetTop-e.offsetTop;return Math.sqrt(i*i+s*s)},startMove:function(e,i){t(e).animate({left:""+i.left,top:""+i.top},this.aniTime)},destroy:function(){for(i=0;i<this.dragLen;i++)this.dragItem[i].onmousedown=null}},t.fn.drag=function(i){if("object"===t.type(i)||"undefined"===t.type(i)){var s={dragWidth:200,dragZindex:2,activeClass:"active",aniTime:400},n=new e(this,t.extend({},s,i));this.data("drag",n)}else{var a,n=this.data("drag");if(n[i]&&t.isFunction(n[i])&&(a=n[i].call(n,Array.prototype.slice.call(arguments,1))),a)return a}return this}}(jQuery),$("#drag-list li").drag({aniTime:500}),$(document).on("exchanged",function(){console.log("exchanged")});</script></body></html>
