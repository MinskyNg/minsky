!function(s){s(document).ready(function(){function e(e,a){s("#user-label").text("在线用户 ("+a+")"),s("#users-list").empty().append('<li alt="all" title="双击聊天" class="sendto">所有人</li>');for(var t in e)s("#users-list").append('<li alt="'+e[t]+'" title="双击聊天">'+e[t]+"</li>");s("#users-list  li").dblclick(function(){s(this).attr("alt")!=c&&(o=s(this).attr("alt"),s("#users-list  li").removeClass("sendto"),s(this).addClass("sendto"),n())})}function n(){s("#sender").html(c),s("#receiver").html("all"==o?"所有人":o)}function a(){var s=new Date,e=s.getMonth()+1+"-"+s.getDate()+" "+s.getHours()+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes());return e}function t(){i.scrollTop=i.scrollHeight}var i=document.getElementById("content-show"),c=s.cookie("user");if(void 0===c&&(s(".button-login").click(function(e){var n=e||event;n.preventDefault();var a=s("#name").val().replace(/(^\s*)|(\s*$)/g,"");""===a||null===a?alert("用户名未输入!"):s.ajax({url:"/chatroom",type:"post",dataType:"json",data:{name:a},success:function(s){s.success===!1?document.getElementById("warning").style.visibility="":(document.getElementById("warning").style.visibility="hidden",window.location.reload())}})}),document.getElementById("login").style.display=""),void 0!==c){var o="all",l=io();l.emit("online",{user:c}),n(),l.on("online",function(n){if(n.user!=c)var a='<div class="message message-info"><span class="icon icon-info"></span>系统: 用户 '+n.user+" 上线了！</div>";else var a='<div class="message message-info"><span class="icon icon-info"></span>系统: 欢迎进入聊天室！</div>';s("#content-show").append(a),t(),e(n.users,n.count)}),l.on("send",function(e){"all"==e.receiver&&s("#content-show").append('<div class="message message-sender">'+e.sender+'<span class="message-time"><span class="icon icon-time"></span>'+a()+'</span></div><div class="message message-public">'+e.msg+"</div>"),e.receiver==c&&s("#content-show").append('<div class="message message-sender">'+e.sender+' 对你说:<span class="message-time"><span class="icon icon-time"></span>'+a()+'</span></div><div class="message message-private">'+e.msg+"</div>"),t()}),s(window).keydown(function(s){var e=s||event;116==e.keyCode&&(confirm("刷新将会清除所有聊天记录，确定要刷新吗？")||e.preventDefault())}),s("#input-message").focusout(function(){var e=s(this);e.text().trim().length||e.empty()}),s(".button-send").click(function(){var e=s("#input-message").html();""!=e&&("all"==o?s("#content-show").append('<div class="message message-sender">'+c+'<span class="message-time"><span class="icon icon-time"></span>'+a()+'</span></div><div class="message message-public">'+e+"</div>"):s("#content-show").append('<div class="message message-sender">你对 '+o+' 说:<span class="message-time"><span class="icon icon-time"></span>'+a()+'</span></div><div class="message message-private">'+e+"</div>"),t(),l.emit("send",{sender:c,receiver:o,msg:e}),s("#input-message").html("").focus())}),s(".button-clear").click(function(){s("#content-show").empty()}),l.on("offline",function(a){var i='<div class="message message-info"><span class="icon icon-info"></span>系统: 用户 '+a.user+"  下线了！</div>";s("#content-show").append(i),t(),e(a.users,a.count),a.user==o&&(o="all",n())}),l.on("disconnect",function(){var e='<div class="message message-warn"><span class="icon icon-warn"></span>系统: 连接服务器失败！</div>';s("#content-show").append(e),t(),s("#users-list").empty()}),l.on("reconnect",function(){var e='<div class="message message-success"><span class="icon icon-success"></span>系统: 重新连接服务器！</div>';s("#content-show").append(e),t(),l.emit("online",{user:c})})}})}(jQuery);